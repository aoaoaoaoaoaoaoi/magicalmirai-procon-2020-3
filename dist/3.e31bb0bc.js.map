{"version":3,"sources":["index.js"],"names":["TextAliveApp","Player","songUrl","isAnimation","lyricDivArray","animateWord","now","unit","contains","$","html","text","run","empty","player","app","mediaElement","document","querySelector","console","log","c","lyricId","addListener","onAppReady","createFromSongUrl","onVideoReady","v","infoContents","onTimerReady","requestPlay","onTimeUpdate","position","video","firstChar","current","firstPhrase","fontSize","startTime","div","createElement","push","id","style","top","str","charArray","split","i","length","span","innerHTML","appendChild","append","setAnimation","next","delay","timer","setInterval","move","forEach","item","index","currentPos","parseInt","newPos","window"],"mappings":"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","file":"3.e31bb0bc.js","sourceRoot":"..","sourcesContent":["const { Player } = TextAliveApp;\r\n\r\nlet songUrl = 'https://www.youtube.com/watch?v=a-Nf3QUFkOU';\r\nlet isAnimation = false;\r\nlet lyricDivArray = [];\r\n\r\n// 単語ごとに歌詞を表示\r\nconst animateWord = (now, unit) => {\r\n  if (unit.contains(now)) {\r\n    $('#text').html(unit.text);\r\n  }\r\n};\r\n\r\nconst run = () =>{\r\n  //初期化処理\r\n  $('#info').empty();\r\n  $('#media').empty();\r\n\r\n  const player = new Player({ app: true , mediaElement: document.querySelector('#media')});\r\n  console.log('Run');\r\n\r\n  let c;\r\n  let lyricId = 1;\r\n  player.addListener({\r\n    onAppReady: (app) => {\r\n      console.log('AppReady');\r\n      player.createFromSongUrl(songUrl);\r\n    },\r\n\r\n    // 楽曲情報読み込み完了後、呼ばれる\r\n    // この時点ではrequestPlay()等が実行不能\r\n    onVideoReady: (v) => {\r\n      console.log('VideoReady');\r\n      let infoContents = '';\r\n      /*infoContents += '<h1>楽曲情報</h1>';\r\n      infoContents += '<h2>楽曲名：<br>' + player.data.song.name + '</h2>';\r\n      infoContents += '<h2>アーティスト名：<br>' + player.data.song.artist.name + '</h2>';\r\n      $('#info').html(infoContents);*/\r\n      $('#text').html('[再生準備待機中]');\r\n    },\r\n\r\n    // 再生準備完了後、呼ばれる\r\n    // これ以降、requestPlay()等が実行可能\r\n    onTimerReady: () => {\r\n      console.log('TimerReady');\r\n      $('#text').html('');\r\n      player.requestPlay();\r\n      // 定期的に呼ばれる各単語の \"animate\" 関数をセットする\r\n      /*let w = player.video.firstPhrase;\r\n      while (w) {\r\n        w.animate = animateWord;\r\n        w = w.next;\r\n      }*/\r\n    },\r\n\r\n    onTimeUpdate: (position) => {\r\n      // 歌詞情報がなければこれで処理を終わる\r\n      if (!player.video.firstChar) {\r\n        return;\r\n      }\r\n  \r\n      // 500ms先から始まる文字～フレーズの最後まで取得\r\n      let current = c || player.video.firstPhrase;\r\n      let fontSize = 50;\r\n      while (current && current.startTime < position + 500) {\r\n        if (c !== current) {\r\n          const div = document.createElement(\"div\");\r\n          lyricDivArray.push(div);\r\n          div.id = \"lyric_\" + lyricId;\r\n          lyricId++;\r\n          div.style.position = 'absolute';\r\n          div.style.top = 510 + \"px\";\r\n            let str = current.text;\r\n            let charArray = str.split('');\r\n            for(var i = 0; i < charArray.length; ++i){\r\n              const span = document.createElement(\"span\");\r\n              span.style.fontSize = fontSize + \"px\";\r\n              span.innerHTML = charArray[i];\r\n              div.appendChild(span);\r\n              fontSize -= 1;\r\n            }\r\n            $('#text').append(div);\r\n          c = current;\r\n        }\r\n        if(!isAnimation){\r\n          isAnimation = true;\r\n          setAnimation();\r\n        }\r\n        current = current.next;\r\n      }\r\n    },\r\n  \r\n  });\r\n}\r\n\r\nconst setAnimation = () =>{\r\n  let delay = 1000 / 50; // 1 秒で 50 フレーム\r\n  let timer = setInterval(function() {\r\n  //500ms\r\n  let move = 8;\r\n  lyricDivArray.forEach((item, index) => {\r\n    let currentPos = parseInt(item.style.top);\r\n    let newPos = (currentPos - move);\r\n    item.style.top = newPos + \"px\";\r\n  });\r\n}, delay)\r\n};\r\n\r\nwindow.run = run"]}